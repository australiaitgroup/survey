# PostCSS/Tailwind Jenkins å…¼å®¹æ€§ä¿®å¤æ€»ç»“

## é—®é¢˜æè¿°
Jenkins æ„å»ºä¸»å‰ç«¯æ—¶é‡åˆ° PostCSS/Tailwind é…ç½®å…¼å®¹æ€§é—®é¢˜ï¼Œå¯¼è‡´æ„å»ºå¤±è´¥ã€‚

## æ ¹æœ¬åŸå› 
1. **æ’ä»¶ä¸ä¸€è‡´**: fallback é…ç½®ä¸­ä½¿ç”¨äº† `tailwindcss` è€Œé `@tailwindcss/postcss`
2. **ç¯å¢ƒå·®å¼‚**: Jenkins ç¯å¢ƒå¯¹æŸäº› ES æ¨¡å—å’ŒåŸç”Ÿä¾èµ–å¤„ç†ä¸ä¸€è‡´
3. **å†…å­˜é™åˆ¶**: å¤§å‹å‰ç«¯é¡¹ç›®å¯èƒ½è¶…å‡ºé»˜è®¤çš„ Node.js å†…å­˜é™åˆ¶

## è§£å†³æ–¹æ¡ˆ

### 1. ä¿®å¤ PostCSS é…ç½®ä¸€è‡´æ€§
**æ–‡ä»¶**: `client/postcss.config.fallback.js`
```javascript
// ä¿®æ”¹å‰
export default {
  plugins: {
    tailwindcss: {},  // âŒ ä¸ä¸€è‡´
    autoprefixer: {},
  },
};

// ä¿®æ”¹å
export default {
  plugins: {
    '@tailwindcss/postcss': {},  // âœ… ä¸ä¸»é…ç½®ä¸€è‡´
    autoprefixer: {},
  },
};
```

### 2. åˆ›å»º Jenkins ä¸“ç”¨é…ç½®
**æ–°å¢æ–‡ä»¶**: `client/postcss.config.jenkins.js`
```javascript
// ä½¿ç”¨ CommonJS è¯­æ³•æé«˜å…¼å®¹æ€§
module.exports = {
  plugins: {
    '@tailwindcss/postcss': {},
    autoprefixer: {},
  },
};
```

### 3. ä¼˜åŒ–ç”Ÿäº§ç¯å¢ƒå˜é‡
**æ›´æ–°æ–‡ä»¶**: `client/.env.production`
```bash
# æ–°å¢çš„æ„å»ºä¼˜åŒ–å‚æ•°
NODE_ENV=production
VITE_NODE_ENV=production
GENERATE_SOURCEMAP=false
CI=true
NODE_OPTIONS=--max-old-space-size=4096
```

### 4. å¢å¼º Jenkinsfile é”™è¯¯å¤„ç†
**æ›´æ–°æ–‡ä»¶**: `Jenkinsfile_main_frontend`

**ä¾èµ–å®‰è£…é˜¶æ®µä¼˜åŒ–**:
- æ·»åŠ ç¯å¢ƒä¿¡æ¯è¾“å‡º
- ä½¿ç”¨ `npm ci` ä»£æ›¿ `npm install` æé«˜ç¨³å®šæ€§
- æ·»åŠ ä¾èµ–éªŒè¯æ­¥éª¤
- ä½¿ç”¨ Jenkins ä¸“ç”¨ PostCSS é…ç½®

**æ„å»ºé˜¶æ®µä¼˜åŒ–**:
- è¯¦ç»†çš„æ„å»ºæ—¥å¿—è¾“å‡º
- å†…å­˜é™åˆ¶ä¼˜åŒ– (`NODE_OPTIONS=--max-old-space-size=4096`)
- æ„å»ºå¤±è´¥æ—¶è¾“å‡ºè¯¦ç»†æ—¥å¿—
- æ„å»ºäº§ç‰©éªŒè¯å’Œç»Ÿè®¡

### 5. åˆ›å»ºæœ¬åœ°æµ‹è¯•è„šæœ¬
**æ–°å¢æ–‡ä»¶**: `test-jenkins-build.sh`
- æ¨¡æ‹Ÿ Jenkins ç¯å¢ƒè¿›è¡Œæœ¬åœ°æµ‹è¯•
- è‡ªåŠ¨å¤‡ä»½å’Œæ¢å¤é…ç½®
- éªŒè¯æ„å»ºå…¼å®¹æ€§

## å…³é”®æ”¹è¿›ç‚¹

### ğŸ”§ æŠ€æœ¯æ”¹è¿›
1. **é…ç½®ç»Ÿä¸€**: æ‰€æœ‰ PostCSS é…ç½®æ–‡ä»¶éƒ½ä½¿ç”¨ `@tailwindcss/postcss`
2. **å…¼å®¹æ€§**: Jenkins é…ç½®ä½¿ç”¨ CommonJS è¯­æ³•
3. **å†…å­˜ä¼˜åŒ–**: è®¾ç½® Node.js å†…å­˜é™åˆ¶ä¸º 4GB
4. **ä¾èµ–ç®¡ç†**: ä½¿ç”¨ `npm ci` å’Œ `--legacy-peer-deps` æé«˜ç¨³å®šæ€§

### ğŸ“Š ç›‘æ§æ”¹è¿›
1. **è¯¦ç»†æ—¥å¿—**: è¾“å‡ºç¯å¢ƒä¿¡æ¯ã€é…ç½®å†…å®¹ã€æ„å»ºç»Ÿè®¡
2. **é”™è¯¯å¤„ç†**: æ„å»ºå¤±è´¥æ—¶è¾“å‡ºè¯¦ç»†é”™è¯¯ä¿¡æ¯
3. **éªŒè¯æ­¥éª¤**: æ£€æŸ¥ä¾èµ–å®‰è£…å’Œæ„å»ºäº§ç‰©

### ğŸ§ª æµ‹è¯•æ”¹è¿›
1. **æœ¬åœ°æµ‹è¯•**: æä¾›è„šæœ¬æ¨¡æ‹Ÿ Jenkins ç¯å¢ƒ
2. **é…ç½®ç®¡ç†**: è‡ªåŠ¨å¤‡ä»½å’Œæ¢å¤åŸå§‹é…ç½®

## é¢„æœŸæ•ˆæœ

1. **æ„å»ºç¨³å®šæ€§**: è§£å†³ PostCSS/Tailwind å…¼å®¹æ€§é—®é¢˜
2. **é”™è¯¯è¯Šæ–­**: è¯¦ç»†æ—¥å¿—ä¾¿äºå¿«é€Ÿå®šä½é—®é¢˜
3. **å¼€å‘æ•ˆç‡**: æœ¬åœ°æµ‹è¯•è„šæœ¬å‡å°‘è°ƒè¯•æ—¶é—´
4. **éƒ¨ç½²å¯é æ€§**: å¢å¼ºçš„é”™è¯¯å¤„ç†ç¡®ä¿éƒ¨ç½²è´¨é‡

## éªŒè¯æ­¥éª¤

1. **æœ¬åœ°æµ‹è¯•**:
   ```bash
   ./test-jenkins-build.sh
   ```

2. **Jenkins æ„å»º**:
   - è§¦å‘ `deploy-main-frontend` ä»»åŠ¡
   - æ£€æŸ¥æ„å»ºæ—¥å¿—è¾“å‡º
   - éªŒè¯ S3 éƒ¨ç½²ç»“æœ

3. **åŠŸèƒ½éªŒè¯**:
   - è®¿é—®ä¸»åŸŸåæ£€æŸ¥å‰ç«¯åŠ è½½
   - éªŒè¯ CSS æ ·å¼æ­£ç¡®åº”ç”¨
   - ç¡®è®¤ API ä»£ç†æ­£å¸¸å·¥ä½œ

## å›æ»šæ–¹æ¡ˆ

å¦‚æœæ–°é…ç½®å‡ºç°é—®é¢˜ï¼Œå¯ä»¥å¿«é€Ÿå›æ»š:

1. æ¢å¤åŸå§‹ PostCSS é…ç½®
2. åˆ é™¤ Jenkins ä¸“ç”¨é…ç½®æ–‡ä»¶
3. å›æ»š `.env.production` æ›´æ”¹
4. ä½¿ç”¨å¤‡ä»½çš„ Jenkinsfile ç‰ˆæœ¬

---

**ä¿®å¤å®Œæˆæ—¶é—´**: $(date)
**ç›¸å…³æ–‡ä»¶**: 
- `client/postcss.config.fallback.js` (ä¿®æ”¹)
- `client/postcss.config.jenkins.js` (æ–°å¢)
- `client/.env.production` (ä¿®æ”¹)
- `Jenkinsfile_main_frontend` (ä¿®æ”¹)
- `test-jenkins-build.sh` (æ–°å¢)
