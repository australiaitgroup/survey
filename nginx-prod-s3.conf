# 生产环境 Nginx配置 - S3部署版本
# 注意：需要将CLIENT_S3_BUCKET替换为实际的生产环境bucket名称

# Client应用代理
location /admin/ {
    include /etc/nginx/proxy_params;
    proxy_pass http://prod.sigmaq.co.s3-website-ap-southeast-2.amazonaws.com;
    proxy_intercept_errors on;
    error_page 404 =200 /index.html;
    proxy_read_timeout 90s;
}

# Super Admin应用代理
location /super-admin/ {
    include /etc/nginx/proxy_params;
    proxy_pass http://prod.sigmaq.co.s3-website-ap-southeast-2.amazonaws.com/super-admin/;
    proxy_intercept_errors on;
    error_page 404 =200 /super-admin/index.html;
    proxy_read_timeout 90s;
}

# API代理到后端服务器
location /api/ {
    include /etc/nginx/proxy_params;
    proxy_pass http://localhost:5050/api/;
    proxy_read_timeout 90s;
    
    # 设置更长的超时时间用于文件上传
    proxy_connect_timeout 90s;
    proxy_send_timeout 90s;
    client_max_body_size 100M;
}

# 健康检查端点
location /health {
    proxy_pass http://localhost:5050/health;
    include /etc/nginx/proxy_params;
}

# 根路径重定向
location = / {
    return 301 /admin/;
}

# 处理其他路径，重定向到admin
location / {
    return 301 /admin$request_uri;
}